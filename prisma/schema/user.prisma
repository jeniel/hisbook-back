model User {
  id                 String  @id @default(uuid())
  /// @Validator.@IsEmail()
  email              String?  @unique
  username           String  @unique
  /// @HideField()
  hashedPassword     String  @map("hashed_password")
  hashedRefreshToken String? @map("hashed_refresh_token")
  createdAt          DateTime?  @default(now())

  // Relations
  role               Role[]               @default([USER])
  profile            Profile?
  posts              Posts[]
  tickets            Ticket[]             @relation("TicketCreatedBy")
  auditLogs          AuditLog[]

  departmentId String?     @map("department_id")
  department   Department? @relation(fields: [departmentId], references: [id])

  @@map("user")
  @@schema("global")
}

model Profile {
  id         String    @id @default(uuid())
  firstName  String?   @map("first_name")
  middleName String?   @map("middle_name")
  lastName   String?   @map("last_name")
  birthDate  DateTime? @map("birth_date")
  gender     Gender?   @map("gender")
  title      String?   @map("title")
  address    String?
  contact    String?
  avatar     String?
  employeeID String? @unique @map("employee_id")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @default(now()) @updatedAt @map("updated_at")

  // Relations
  userId String? @unique @map("user_id")
  user   User?   @relation(fields: [userId], references: [id])

  @@map("profile")
  @@schema("global")
}

model Department {
  id          String @id @default(uuid())
  name        String @unique
  description String
  createdAt   DateTime  @default(now())
  isSupport  Boolean   @default(false) @map("is_support")

  // Relations
  users   User[]
  tickets Ticket[]

  @@map("department")
  @@schema("global")
}

enum Role {
  USER
  ADMIN

  @@schema("global")
}

enum Gender {
  Male
  Female
  Others

  @@schema("global")
}

model Posts {
  id         String   @id @default(uuid())
  content    String
  datePosted DateTime @default(now())
  images     String[]   // store image URLs directly
  userId     String?
  user       User?   @relation(fields: [userId], references: [id])

  @@map("posts")
  @@schema("global")
}

model Ticket {
  id          String     @id @default(uuid())
  subject     String     // Short title of the ticket
  missedAt    DateTime?  // Optional: for missed logout cases
  floor       String?    // Optional: Example "B1 Biometrics"
  screenshot  String?    // Optional: Screenshot URL or path
  message     String?    // Detailed message/request
  status      Status     @default(Pending)
  remarks     String?
  createdAt   DateTime   @default(now())
  updatedBy String?
  updatedAt   DateTime   @updatedAt

  // Relations
  createdById String
  createdBy   User        @relation("TicketCreatedBy", fields: [createdById], references: [id])

  departmentId String
  department   Department @relation(fields: [departmentId], references: [id])

  auditLogs    AuditLog[]

  @@map("ticket")
  @@schema("global")
}

model AuditLog {
  id          String    @id @default(uuid())
  action      String?   // Description of action (ex: "Updated status to Resolved")
  remarks String?
  timestamp   DateTime  @default(now()) // Timestamp of the action
  updatedBy   String?   // User's name or identifier
  userId      String?   // ID of the user who performed the action
  user        User?     @relation(fields: [userId], references: [id])

  ticketId    String?
  ticket      Ticket?   @relation(fields: [ticketId], references: [id])

  @@map("auditlog")
  @@schema("global")
}

enum Status {
  Pending
  Approved
  Completed
  OnHold
  InProgress

  @@schema("global")
}

model Event {
  id         String    @id @default(uuid())
  title      String
  startDate  DateTime?
  endDate    DateTime?
  location   String
  detailsUrl String?
  createdAt  DateTime  @default(now())
  deletedAt  DateTime?

  @@map("event")
  @@schema("global")
}
